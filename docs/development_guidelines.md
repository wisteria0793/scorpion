# 開発ガイドライン

このドキュメントは、本プロジェクトにおける開発の進め方、規約、設計思想をまとめたものです。

## 1. コーディング規約

コードの品質と一貫性を保つため、以下の規約に従ってください。

### バックエンド (Python/Django)
- **フォーマッター:** `Black` を使用してコードを自動フォーマットします。
- **Linter:** `Flake8` を使用して文法エラーや非推奨の書き方をチェックします。
- **インポート順序:** `isort` を使用してインポート文を自動で整理します。
- **命名規則:**
    - 変数・関数: `snake_case`
    - クラス: `PascalCase`
- **準拠:** 上記ツールは基本的に [PEP 8](https://pep8-ja.readthedocs.io/ja/latest/) に準拠します。

### フロントエンド (JavaScript/React)
- **フォーマッター:** `Prettier` を使用してコードを自動フォーマットします。
- **Linter:** `ESLint` を使用します。設定は `eslint.config.js` を参照してください。
- **命名規則:**
    - 変数・関数: `camelCase`
    - コンポーネント: `PascalCase`
    - CSSクラス: `kebab-case` (例: `.facility-card`)

## 2. テスト方針

### バックエンド
- **フレームワーク:** `pytest` を使用します。
- **テスト対象:** 主にビジネスロジックが含まれるサービスクラスや、複雑なクエリを持つモデルのメソッドを対象とします。APIのエンドポイントレベルのテストも記述します。

### フロントエンド
- **フレームワーク:** `Jest` と `React Testing Library` を使用します。
- **テスト対象:** カスタムフックや、状態を持つ複雑なコンポーネントを中心にテストを記述します。

## 3. APIエラーハンドリング

APIがエラーを返却する際は、以下のJSONフォーマットに統一します。

```json
{
  "error": {
    "code": "resource_not_found",
    "message": "指定されたリソースは見つかりませんでした。",
    "details": "Reservation with ID 123 not found."
  }
}
```
- `code`: エラーの種類を示す機械可読な文字列
- `message`: フロントエンドで表示することを想定した、ユーザー向けのメッセージ
- `details`: 開発者がデバッグに利用するための詳細情報

## 4. バックエンド設計

Djangoの主要なクラス（Model, Serializer, ViewSet）の関係性については、以下のドキュメントを参照してください。

- [アーキテクチャ (クラス図)](./architecture_class_diagram.md)

## 5. フロントエンド設計: 共通APIクライアント

フロントエンドからバックエンドへのAPI通信は、`axios`を利用しています。

- **単一の`axios`インスタンス:** アプリケーション全体でAPIクライアントの設定（ベースURL、認証情報、ヘッダーなど）を統一するため、`src/services/apiClient.js`にて単一の`axios`インスタンスを生成し、`export`しています。
- **CSRFトークンの自動設定:** ユーザーの認証状態を管理する`AuthContext`は、アプリケーション起動時にこの共通`apiClient`インスタンスを取得し、CSRFトークンをデフォルトヘッダーに設定します。
- **規約:** 新しくAPI通信を行うサービスファイルを作成する際は、必ずこの共通の`apiClient`をインポートして利用してください。これにより、CSRF対策などが全てのAPIリクエストに一貫して適用されます。

詳細な構成については、[フロントエンドガイド](./frontend_guide.md)を参照してください。

## 6. 環境変数

プロジェクトで利用する環境変数は、各ディレクトリの `.env.example` ファイルに記載しています。開発を始める前に、これをコピーして `.env` ファイルを作成し、適切な値を設定してください。

**注意:** `.env` ファイルをGitの管理に含めないでください。
